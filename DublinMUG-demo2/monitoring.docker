FROM ubuntu:16.04
MAINTAINER byron

ENV SERVICE_USER "mongodb-mms-agent"

RUN apt-get -qqy update && apt-get install -qqy \
        curl \
        sudo \
        ca-certificates \
        libsasl2-2 \
        numactl \
        logrotate

ADD https://cloud.mongodb.com/download/agent/monitoring/mongodb-mms-monitoring-agent_latest_amd64.ubuntu1604.deb /root/mongodb-mms-monitoring-agent_latest_amd64.ubuntu1604.deb

RUN dpkg -i /root/mongodb-mms-monitoring-agent_latest_amd64.ubuntu1604.deb
RUN         adduser --disabled-password \
                --quiet \
                --system \
                --home /nonexistent \
                --no-create-home \
                --group mongodb-mms-agent \
                --shell /bin/false

RUN chmod 755 /usr/bin/mongodb-mms-monitoring-agent
RUN chown $SERVICE_USER:$SERVICE_USER /usr/bin/mongodb-mms-monitoring-agent



COPY monitoring-agent.config /etc/mongodb-mms/monitoring-agent.config
RUN chown $SERVICE_USER:$SERVICE_USER /etc/mongodb-mms/monitoring-agent.config

EXPOSE 27000

USER $SERVICE_USER:$SERVICE_USER

CMD ["/usr/bin/mongodb-mms-monitoring-agent", "-conf", "/etc/mongodb-mms/monitoring-agent.config"]
